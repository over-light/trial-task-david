/* eslint-disable @typescript-eslint/no-unsafe-member-access */
/* eslint-disable @typescript-eslint/no-unsafe-assignment */
/* eslint-disable @typescript-eslint/no-unsafe-argument */
import * as React from 'react'
import Link from 'next/link';

import { ethers } from 'ethers';
import { signIn } from 'next-auth/react';

import {
    Card,
    CardContent,
    CardDescription,
    CardFooter,
    CardHeader,
    CardTitle,
} from '~/components/ui/card'

declare global {
    interface Window {
        ethereum?: any; // eslint-disable-line @typescript-eslint/no-explicit-any
    }
}

export default function Home() {
    return (
        <main className="flex min-h-screen flex-col p-6 justify-center">
            <div className="flex justify-center align-middle">
                <Card className="w-[450px] h-[350px] bg-[#181d2a]">
                    <CardHeader className="items-center">
                        <svg width='50%' height='30%' viewBox='0 0 256 257' xmlns='http://www.w3.org/2000/svg' preserveAspectRatio='xMidYMid'><path d='M210.377 126.784c0 46.231-37.477 83.708-83.708 83.708s-83.708-37.477-83.708-83.708 37.477-83.708 83.708-83.708 83.708 37.477 83.708 83.708' fill="#4D37B9" /><path d="M79.509 87.972l37.24-21.501a20.008 20.008 0 0 1 20.005 0l37.24 21.501a20.002 20.002 0 0 1 10.002 17.324v43.002a20.002 20.002 0 0 1-10.002 17.324l-37.24 21.501a20.003 20.003 0 0 1-20.005 0l-37.24-21.501a20.003 20.003 0 0 1-10.003-17.324v-43.002a20.003 20.003 0 0 1 10.003-17.324" fill="#FFF" /><g fill="#4D37B9"><path d="M126.537 99.521c9.416.001 18.832-.029 28.248.011 5.789.025 7.561 1.879 7.57 7.71.002 1.457.015 2.914-.003 4.371-.056 4.656-2.06 6.712-6.804 6.796-4.258.076-8.519-.026-12.778.029-5.013.065-6.869 1.929-6.886 6.95-.034 9.864.009 17.64 0 27.504 0 9.462-1.694 10.341-8.073 10.359-9.474.027-10.353-.846-10.353-10.359 0-9.08.025-18.159 0-27.239-.015-5.416-1.806-7.177-7.296-7.22-4.147-.033-8.297.058-12.443-.025-4.711-.094-6.684-2.164-6.733-6.866-.016-1.569-.008-3.139-.002-4.708.023-5.328 1.892-7.255 7.305-7.298 7.173-.057 14.348-.015 21.522-.015h6.726" /><path d="M144.132 132.591c0-2.272 1.809-2.441 1.809-2.441h6.354c3.745 0 6.733 3.577 6.733 7.07 0 2.606-1.219 4.321-1.837 5.024a.583.583 0 0 0-.014.755c.632.791 1.935 2.699 1.935 4.993 0 3.029-2.104 7.027-6.691 7.027h-6.48s-1.725.463-1.725-1.936c0-2.398 1.725-2.146 1.725-2.146h6.354c1.809 0 2.062-1.304 2.062-2.987 0-1.684-.757-3.03-2.062-3.03h-6.354s-1.767.126-1.767-2.188c0-2.315 1.767-2.399 1.767-2.399h6.354c1.473 0 2.062-1.599 2.062-2.861 0-1.262-.589-2.567-2.062-2.567h-6.354s-1.809-.042-1.809-2.314" /></g><g><path d="M220.841 42.795a7.995 7.995 0 1 1-15.99 0 7.995 7.995 0 0 1 15.99 0" fill="#B300E3" /><path d="M256 127.476a7.995 7.995 0 1 1-15.99 0 7.995 7.995 0 0 1 15.99 0" fill="#4E00BF" /><path d="M221.114 212.52a7.995 7.995 0 1 1-15.99 0 7.995 7.995 0 0 1 15.99 0" fill="#0EBBF0" /><path d="M136.369 248.305a7.994 7.994 0 0 1-7.995 7.994 7.995 7.995 0 1 1 7.995-7.994" fill="#93E477" /><path d="M51.175 212.52a7.994 7.994 0 1 1-15.989 0 7.995 7.995 0 1 1 15.989 0" fill="#DDE6EC" /><path d="M15.99 127.626a7.996 7.996 0 1 1-15.991-.001 7.996 7.996 0 0 1 15.991.001" fill="#FE4545" /><path d="M51.026 42.881a7.996 7.996 0 1 1-15.991-.001 7.996 7.996 0 0 1 15.991.001" fill="#FEB900" /><path d="M136.369 7.995a7.995 7.995 0 1 1-15.99 0 7.995 7.995 0 0 1 15.99 0" fill="#47E8E2" /></g></svg>
                        <CardTitle className="text-center text-2xl text-white">Welcome to Trial-Task</CardTitle>
                    </CardHeader>
                    <CardFooter className="flex justify-center pb-2">
                        <div
                            className="flex justify-center align-middle mx-10 normal-case transition-all font-semibold rounded h-10 min-h-[2.5rem] text-lg px-4 text-fg-interactive bg-blue-500 border-primar hover:bg-blue-400 hover:cursor-pointer focus:bg-blue-500 focus:border-primary-focus w-full"
                            onClick={onSignInWithCrypto}
                        ><span className="flex items-center justify-center gap-x-1"><div className="flex gap-x-2"><span className="flex items-center justify-center text-fg-interactive h-5 w-5"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" className="w-full h-full object-contain" viewBox="0 0 1024.000000 1024.000000" preserveAspectRatio="xMidYMid meet"><g transform="translate(0.000000,1024.000000) scale(0.100000,-0.100000)" fill="white" stroke="none"><path d="M7672 8691 c-41 -42 -234 -240 -430 -440 -197 -200 -395 -402 -441
                -450 -46 -47 -227 -233 -403 -413 -515 -526 -586 -600 -851 -872 -139 -142
                -253 -262 -255 -267 -2 -5 37 -76 87 -158 50 -83 91 -152 91 -154 0 -2 28 -52
                63 -110 34 -57 69 -118 79 -133 9 -16 44 -76 78 -134 35 -58 74 -125 88 -150
                14 -25 34 -58 44 -75 10 -16 18 -34 18 -38 0 -10 -88 58 -181 140 -36 32 -92
                81 -124 108 -33 28 -82 70 -110 95 -28 25 -63 54 -77 65 -14 11 -43 36 -65 55
                -21 19 -65 58 -98 85 -32 28 -71 61 -85 74 -14 13 -39 34 -57 48 l-32 25 -23
                -24 c-13 -13 -63 -68 -113 -123 -49 -55 -104 -116 -122 -135 -18 -19 -29 -39
                -25 -46 4 -7 117 -126 252 -265 135 -139 259 -267 275 -284 17 -17 102 -106
                190 -196 177 -183 568 -589 635 -659 52 -55 208 -218 395 -410 77 -80 253
                -262 390 -405 236 -246 325 -338 612 -635 66 -69 153 -159 192 -200 40 -41
                132 -136 204 -211 73 -74 219 -226 326 -337 107 -111 196 -200 198 -198 6 5
                -50 115 -98 194 -22 35 -39 66 -39 69 0 3 -22 43 -50 89 -27 46 -50 86 -50 90
                0 5 -11 24 -23 43 -13 20 -73 124 -132 231 -59 107 -145 260 -190 340 -46 80
                -100 179 -122 220 -22 41 -54 98 -71 126 -18 28 -32 54 -32 58 0 3 -11 23 -23
                44 -13 20 -67 114 -119 207 -53 94 -106 188 -119 210 -12 22 -32 58 -44 80
                -12 22 -45 82 -74 134 -29 51 -56 100 -61 110 -5 9 -29 51 -54 93 -25 43 -46
                81 -46 86 0 4 -11 23 -23 42 -13 19 -40 64 -59 100 -20 36 -77 139 -127 229
                -50 90 -91 165 -91 166 0 2 -27 48 -59 103 -33 55 -85 149 -117 209 -31 59
                -68 124 -80 143 -13 19 -24 38 -24 42 0 4 -16 32 -35 62 -19 30 -35 57 -35 60
                0 3 -30 57 -66 120 -51 88 -65 121 -60 140 6 24 92 204 333 696 151 308 301
                614 416 850 46 96 148 304 226 463 77 158 141 289 141 292 0 2 83 172 185 377
                102 205 185 376 185 380 0 17 -18 2 -88 -71z"></path><path d="M1610 8398 c0 -2 11 -25 25 -49 13 -24 33 -62 43 -84 10 -22 32 -61
                47 -85 16 -25 39 -63 51 -85 35 -65 79 -145 124 -225 24 -41 58 -104 78 -140
                19 -36 49 -90 66 -120 18 -30 43 -75 56 -100 13 -25 42 -76 65 -115 23 -38 63
                -110 90 -160 27 -49 68 -123 92 -162 23 -40 43 -76 43 -79 0 -6 32 -64 177
                -316 40 -70 73 -130 73 -132 0 -2 34 -64 76 -138 42 -73 80 -143 85 -156 5
                -13 13 -21 18 -17 5 3 13 0 17 -6 4 -8 3 -9 -4 -5 -16 10 -15 1 3 -35 9 -17
                21 -27 27 -23 7 4 8 3 4 -5 -5 -7 31 -79 84 -172 50 -89 108 -191 127 -228 20
                -36 64 -115 98 -176 34 -60 88 -157 120 -215 32 -58 75 -134 95 -170 20 -36
                63 -112 95 -170 95 -172 138 -245 149 -252 6 -4 7 -8 3 -8 -5 0 5 -24 21 -52
                17 -29 44 -78 60 -108 l31 -55 -29 -55 c-48 -92 -366 -741 -635 -1296 -46 -95
                -163 -333 -260 -530 -506 -1026 -577 -1175 -572 -1181 3 -2 76 67 162 154 133
                134 791 805 965 983 30 32 174 178 320 327 696 708 1015 1036 1018 1046 1 7
                -8 28 -20 47 -25 39 -54 87 -141 236 -62 105 -64 110 -114 191 -18 30 -33 55
                -33 58 0 5 -44 80 -173 298 -64 109 -80 147 -46 115 8 -7 46 -39 84 -70 39
                -31 79 -65 90 -75 20 -18 236 -205 285 -247 28 -24 159 -136 176 -151 6 -5 33
                -28 59 -50 26 -22 62 -52 79 -67 17 -15 34 -28 37 -28 3 0 30 28 60 62 30 34
                91 102 137 151 45 49 82 96 82 104 0 8 -42 58 -92 110 -324 336 -380 394 -648
                674 -113 118 -272 284 -355 369 -83 85 -193 200 -245 254 -52 55 -115 120
                -140 146 -25 25 -133 138 -240 250 -187 196 -401 418 -485 505 -22 23 -94 97
                -160 166 -66 68 -194 201 -284 294 -90 94 -191 199 -225 235 -33 35 -133 139
                -221 230 -234 242 -424 440 -471 491 -48 53 -104 105 -104 97z"></path></g></svg></span><span className="text-white">Log In</span><span className="flex items-center justify-center text-fg-interactive h-5 w-5"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" className="w-full h-full object-contain" viewBox="0 0 1024.000000 1024.000000" preserveAspectRatio="xMidYMid meet"><g transform="translate(0.000000,1024.000000) scale(0.100000,-0.100000)" fill="white" stroke="none"><path d="M7672 8691 c-41 -42 -234 -240 -430 -440 -197 -200 -395 -402 -441
                -450 -46 -47 -227 -233 -403 -413 -515 -526 -586 -600 -851 -872 -139 -142
                -253 -262 -255 -267 -2 -5 37 -76 87 -158 50 -83 91 -152 91 -154 0 -2 28 -52
                63 -110 34 -57 69 -118 79 -133 9 -16 44 -76 78 -134 35 -58 74 -125 88 -150
                14 -25 34 -58 44 -75 10 -16 18 -34 18 -38 0 -10 -88 58 -181 140 -36 32 -92
                81 -124 108 -33 28 -82 70 -110 95 -28 25 -63 54 -77 65 -14 11 -43 36 -65 55
                -21 19 -65 58 -98 85 -32 28 -71 61 -85 74 -14 13 -39 34 -57 48 l-32 25 -23
                -24 c-13 -13 -63 -68 -113 -123 -49 -55 -104 -116 -122 -135 -18 -19 -29 -39
                -25 -46 4 -7 117 -126 252 -265 135 -139 259 -267 275 -284 17 -17 102 -106
                190 -196 177 -183 568 -589 635 -659 52 -55 208 -218 395 -410 77 -80 253
                -262 390 -405 236 -246 325 -338 612 -635 66 -69 153 -159 192 -200 40 -41
                132 -136 204 -211 73 -74 219 -226 326 -337 107 -111 196 -200 198 -198 6 5
                -50 115 -98 194 -22 35 -39 66 -39 69 0 3 -22 43 -50 89 -27 46 -50 86 -50 90
                0 5 -11 24 -23 43 -13 20 -73 124 -132 231 -59 107 -145 260 -190 340 -46 80
                -100 179 -122 220 -22 41 -54 98 -71 126 -18 28 -32 54 -32 58 0 3 -11 23 -23
                44 -13 20 -67 114 -119 207 -53 94 -106 188 -119 210 -12 22 -32 58 -44 80
                -12 22 -45 82 -74 134 -29 51 -56 100 -61 110 -5 9 -29 51 -54 93 -25 43 -46
                81 -46 86 0 4 -11 23 -23 42 -13 19 -40 64 -59 100 -20 36 -77 139 -127 229
                -50 90 -91 165 -91 166 0 2 -27 48 -59 103 -33 55 -85 149 -117 209 -31 59
                -68 124 -80 143 -13 19 -24 38 -24 42 0 4 -16 32 -35 62 -19 30 -35 57 -35 60
                0 3 -30 57 -66 120 -51 88 -65 121 -60 140 6 24 92 204 333 696 151 308 301
                614 416 850 46 96 148 304 226 463 77 158 141 289 141 292 0 2 83 172 185 377
                102 205 185 376 185 380 0 17 -18 2 -88 -71z"></path><path d="M1610 8398 c0 -2 11 -25 25 -49 13 -24 33 -62 43 -84 10 -22 32 -61
                47 -85 16 -25 39 -63 51 -85 35 -65 79 -145 124 -225 24 -41 58 -104 78 -140
                19 -36 49 -90 66 -120 18 -30 43 -75 56 -100 13 -25 42 -76 65 -115 23 -38 63
                -110 90 -160 27 -49 68 -123 92 -162 23 -40 43 -76 43 -79 0 -6 32 -64 177
                -316 40 -70 73 -130 73 -132 0 -2 34 -64 76 -138 42 -73 80 -143 85 -156 5
                -13 13 -21 18 -17 5 3 13 0 17 -6 4 -8 3 -9 -4 -5 -16 10 -15 1 3 -35 9 -17
                21 -27 27 -23 7 4 8 3 4 -5 -5 -7 31 -79 84 -172 50 -89 108 -191 127 -228 20
                -36 64 -115 98 -176 34 -60 88 -157 120 -215 32 -58 75 -134 95 -170 20 -36
                63 -112 95 -170 95 -172 138 -245 149 -252 6 -4 7 -8 3 -8 -5 0 5 -24 21 -52
                17 -29 44 -78 60 -108 l31 -55 -29 -55 c-48 -92 -366 -741 -635 -1296 -46 -95
                -163 -333 -260 -530 -506 -1026 -577 -1175 -572 -1181 3 -2 76 67 162 154 133
                134 791 805 965 983 30 32 174 178 320 327 696 708 1015 1036 1018 1046 1 7
                -8 28 -20 47 -25 39 -54 87 -141 236 -62 105 -64 110 -114 191 -18 30 -33 55
                -33 58 0 5 -44 80 -173 298 -64 109 -80 147 -46 115 8 -7 46 -39 84 -70 39
                -31 79 -65 90 -75 20 -18 236 -205 285 -247 28 -24 159 -136 176 -151 6 -5 33
                -28 59 -50 26 -22 62 -52 79 -67 17 -15 34 -28 37 -28 3 0 30 28 60 62 30 34
                91 102 137 151 45 49 82 96 82 104 0 8 -42 58 -92 110 -324 336 -380 394 -648
                674 -113 118 -272 284 -355 369 -83 85 -193 200 -245 254 -52 55 -115 120
                -140 146 -25 25 -133 138 -240 250 -187 196 -401 418 -485 505 -22 23 -94 97
                -160 166 -66 68 -194 201 -284 294 -90 94 -191 199 -225 235 -33 35 -133 139
                -221 230 -234 242 -424 440 -471 491 -48 53 -104 105 -104 97z"></path></g></svg></span></div></span></div>
                    </CardFooter>
                </Card>
            </div>
        </main>
    );
}

// This function requests a nonce then signs it, proving that
//  the user owns the public address they are using

async function onSignInWithCrypto() {
    try {
        if (!window.ethereum) {
            window.alert("Please install MetaMask first.");
            return;
        }

        // Get the wallet provider, the signer and address
        //  see: https://docs.ethers.org/v6/getting-started/#starting-signing
        const provider = new ethers.BrowserProvider(window.ethereum);
        console.log(window.ethereum)
        const signer = await provider.getSigner();
        const walletAddress = await signer.getAddress();

        // Send the public address to generate a nonce associates with our account
        const response = await fetch("/api/auth/crypto/generateNonce", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                walletAddress,
            }),
        });
        const responseData = await response.json();

        console.log(responseData)
        // Sign the received nonce
        const signedNonce = await signer.signMessage(responseData.nonce);

        // Use NextAuth to sign in with our address and the nonce
        await signIn("crypto", {
            walletAddress,
            signedNonce,
            callbackUrl: "/",
        });
    } catch {
        window.alert("Error with signing, please try again.");
    }
}
